<script>$('body').attr('id', 'profile-order-list-page');</script>
<script>$('body').addClass('profile-page');</script>

<%= render partial: "client/profile/parts/profile-nav" %>
<script>$('#profile-nav #menu-my-orders').addClass('active');</script>

<div class="section">
  <div class="container">

    <div class="row">
      <div class="col-xs-12">
        <div class="order-list">
          <div class="list-body">
            <% if @orders.count > 0 %>
              <% @orders.each do |order| %>
              <div class="order order-1">
                <div class="order-header row">
                  <div class="col-xs-12 col-md-6 left">
                    เลขที่ออร์เดอร์: <strong><%= order.code %></strong>
                  </div>
                  <div class="col-xs-12 col-md-6 right">
                    สั่งซื้อเมื่อ <span class="created-at" data-created-at="<%= order.created_at %>"><%= order.to_created_at %></span>
                  </div>
                </div>
                <div class="row">
                  <div class="order-body">
                    <div class="col-xs-12 col-md-6 left">
                      <a class="cover" style="background-image: url(<%= order.event.event_pictures.first.try(:media, :thumb) %>);" target="_blank" href="<%= client_event_path(order.event.id) %>"></a>
                      <h4 class="title"><a target="_blank" href="<%= client_event_path(order.event.id) %>"><%= order.event.title %></a></h4>
                      <div class="info-2">
                        <div class="meta location"><i class="icon icon-xs icon-map-pin"></i> <%= order.event.location_name %></div>
                      </div>
                    </div>
                    <div class="col-xs-12 col-md-6 right">
                      <div class="info">
                        <div class="info-header">
                          <table class="table">
                            <tr>
                              <td width="150">ราคารวม</td>
                              <td><%= convert_to_currency order.to_price %></td>
                            </tr>
                            <tr>
                              <td>วิธีการชำระเงิน</td>
                              <td><%= order.payment.channel %></td>
                            </tr>
                            <tr>
                              <td>สถานะการชำระเงิน</td>
                              <td><%= order.status %></td>
                            </tr>
                            <% if order.transfer? %>
                              <tr>
                                <td>รหัสชำระเงิน</td>
                                <td><%= order.code %></td>
                              </tr>
                            <% end %>
                          </table>
                        </div>
                        <div class="info-body">
                          <table class="table ticket-list">
                            <% order.tickets.each do |ticket| %>
                              <tr class="ticket">
                                <td class="ticket-title" width="150"><%= ticket.section.title %></td>
                                <td class="ticket-code"><%= ticket.code %></td>
                                <td class="ticket-price" width="100" align="right"><%= ticket.to_price %></td>
                              </tr>
                            <% end %>
                            <tr class="total">
                              <td></td>
                              <td><strong>TOTAL</strong></td>
                              <td align="right"><strong><%= convert_to_currency order.to_price %></strong></td>
                            </tr>
                          </table>
                        </div>
                        <div class="info-footer">
                          <ul class="nav nav-justified">
                          <% if order.transfer? %>
                            <li><a class="btn btn-daydash btn-daydash-inverse open-payment" data-toggle="modal" data-time="<%= order.expires_on %>" data-price="<%= convert_to_currency order.to_price %>" href="#payment-modal"><i class="icon icon-xs icon-info"></i> วิธีการชำระเงิน</a></li>
                            <li><a class="btn btn-daydash btn-daydash-inverse open-payment" data-toggle="modal" data-time="<%= order.expires_on %>" data-price="<%= convert_to_currency order.to_price %>" href="#payment-modal"><i class="icon icon-xs icon-submit"></i> แจ้งชำระเงิน</a></li>
                          <% else %>
                            <li><a class="btn btn-block btn-daydash btn-daydash-green-1" href="<%= client_profile_tickets_path %>">ดูบัตรเข้าร่วมงาน</a></li>
                          <% end %>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <% end if @has_tickets %>
            <% else %>
              <div class="empty">
                <i class="icon icon-lg icon-shopping"></i>
                <h4 class="description">ยังไม่มีรายการสั่งซื้อ</h4>
                <a class="btn btn-daydash btn-daydash-md btn-daydash-green-1" href="/">ค้นหากิจกรรมและอีเว้นท์ที่น่าสนใจ</a>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="payment-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <table border="0" cellpadding="0" cellspacing="0" style="max-width:100%; min-width:100%;" width="100%" class="mcnTextContentContainer">
          <tbody>
            <tr>
              <td valign="top" class="mcnTextContent" style="padding-top:0; padding-right:18px; padding-bottom:9px; padding-left:18px;">
                <p style="font-size: 24px; font-weight: 200; padding-top: 15px; padding-bottom: 15px; border-bottom: 1px solid black;">วิธีการชำระเงิน</p>
                <p style="font-weight: 200;">
                  1. เลือกโอนยอดเงิน <span class="order-price"></span> บาท ผ่านธนาคารที่คุณสะดวก
                </p>
                <table width="100%">
                  <tbody>
                    <tr>
                      <td width="50%" style="vertical-align: top;">
                        <table>
                          <tr>
                            <td width="60" valign="top">
                              <%= image_tag "#{App.domain}/src/images/email/order/kbank-logo.png", width: "50"  %>
                            </td>
                            <td valign="top">
                              <p style="font-size: 13px; font-weight: 200; margin-top: 0px;">
                                ธนาคารกสิกรไทย สาขาเอกมัย<br />
                                บัญชีออมทรัพย์ <strong>001-3-42202-8</strong>​<br />
                                ชื่อบัญชี นางสาวลินดา ไกรวณิช
                              </p>
                            </td>
                          </tr>
                        </table>
                      </td>
                      <td width="50%" style="vertical-align: top;">
                        <table>
                          <tr>
                            <td width="60" valign="top">
                              <%= image_tag "#{App.domain}/src/images/email/order/scb-logo.png", width: "50"  %>
                            </td>
                            <td valign="top">
                              <p style="font-size: 13px; font-weight: 200; margin-top: 0px;">
                                ธนาคารไทยพาณิชย์<br />
                                สาขาเอกมัย พาวเวอร์ เซ็นเตอร์<br />
                                บัญชีออมทรัพย์ <strong>250-217556-5</strong>​<br />
                                ชื่อบัญชี นางสาวลินดา ไกรวณิช
                              </p>
                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <p style="font-weight: 200; padding-bottom: 30px;">
                  2. แจ้งยืนยันการชำระเงินโดยส่งรูปถ่ายหลักฐานการโอนเงิน<br />
                  พร้อมรหัสการโอนเงิน ผ่านทาง: Line <a href="https://line.me/ti/p/@daydash" target="_blank">@daydash</a> (มี @ ข้างหน้า)
                </p>
                <p style="font-weight: 200; padding-bottom: 30px;">
                  3. เราจะส่งตั๋วให้คุณทางอีเมลเมื่อเราได้รับแจ้งยืนยันการชำระเงินแล้วภายใน 60 นาที :)
                </p>
                <table width="100%">
                  <tr>
                    <td align="center" style="color: red;">
                      <strong>*** กรุณาทำการชำระเงินภายใน 60 นาที นับจากการสั่งซื้อ ***</strong><br />
                      <span class="time-payment">(ชำระภายใน วันที่ 25 กันยายน 2016 เวลา 11:03 PM)</span>
                    </td>
                  </tr>
                </table>
                <br />
                <br />
                <table width="100%">
                  <tr>
                    <td align="center" style="background: #DFFFFB; padding: 15px; font-size: 14px; font-weight: 200;">
                      หากคุณพบปัญหาหรือมีคำถาม ต้องการความช่วยเหลือ สามารถติดต่อเราได้ที่<br />
                      Tel. 080-456-9465  หรือ Line: <a href="https://line.me/ti/p/@daydash" target="_blank">@daydash</a>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(document).on("click", ".open-payment", function(){
    var time = $(this).data('time');
    $(".time-payment").html("(ชำระภายใน วันที่ " + convert_to_datetime(time) + ")");
    $(".order-price").html($(this).data('price'))
  });

  function convert_to_datetime(dt) {
    moment.locale('th');
    return moment(dt).format('D MMMM YYYY เวลา HH:mm')
  }

  $(document).ready(function(){
    $('.created-at').html(convert_to_datetime($('.created-at').attr("data-created-at")));
  });
</script>
