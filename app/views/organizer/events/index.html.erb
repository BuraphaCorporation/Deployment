<% content_for :body_id, 'organizer-event-list' %>
<% content_for :body_class, 'organizer-event-page' %>

<div class="section section-container">
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
        <div class="row">
          <div class="col-xs-9">
            <div class="text-inline ml-10">
              <a href="<%= organizer_events_path %>">ALL (<%= @event.count %>)</a>
            </div>
            <div class="text-inline ml-10">
              <a href="<%= organizer_events_path %>?filter=live">LIVE (<%= @live.count %>)</a>
            </div>
            <div class="text-inline ml-10">
              <a href="<%= organizer_events_path %>?filter=draft">DRAFT (<%= @draft.count %>)</a>
            </div>
            <div class="text-inline ml-10">
              <a href="<%= organizer_events_path %>?filter=past">PAST (<%= @past.count %>)</a>
            </div>
          </div>
          <div class="col-xs-3 text-right">
            <input type="hidden" class="current-url" value="<%= request.original_url %>">
            <select class="sort form-control">
              <option selected disabled>เรียงตาม: Recent</option>
              <option value="asc">Ascending</option>
              <option value="desc">Descending</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <% @events.each do |event| %>
            <div class="event card-side-cover event-for-organizer event-<%= event.organizer_status %>">
              <div style="display: table-cell; width: 100px; text-align: center padding-top: 30px;
    text-align: center;
    font-family: "Helvetica Neue", sans-serif;">
                <div style="font-size: 24px;
    text-transform: uppercase;">
                  <%= event.uptime.try(:strftime, "%b") %>
                </div>
                <div style="font-size: 50px;">
                  <%= event.uptime.try(:strftime, "%d") %>
                </div>
              </div>
              <div class="info">
                <div class="info-body">
                  <h4 class="title"><%= event.title %> <%= event.status == 'published' ? '<div class="btn btn-daydash-status btn-daydash-live">Live</div>'.html_safe : '<div class="btn btn-daydash-status btn-daydash-draft">Draft</div>'.html_safe %></h4>
                  <div class="meta date location"><%= event.to_uptime %> at <%= event.location_name %></div>
                </div>
                <div class="info-footer">
                  <div class="row">
                    <div class="col-xs-12 col-md-4 pull-right">
                      <div class="ticket-sold-panel">
                        <div class="row">
                          <div class="col-xs-7 ticket-sold-label" style="font-size: 14px">จำนวนบัตรขายไป</div>
                          <div class="col-xs-5 ticket-sold-value"><%= event.tickets.paid.count %> / <%= event.sections.total %></div>
                        </div>
                        <div class="row">
                          <div class="col-xs-12">
                            <div class="progress">
                              <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: <%= event.tickets.paid.count / event.sections.total.to_f * 100 %>%;">
                                <span class="sr-only"><%= event.tickets.paid.count / event.sections.total.to_f * 100 %>% Complete</span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-xs-12 col-md-8">
                      <ul class="list-inline list-action-nav">
                        <% if event.status.published? %>
                          <li>
                            <a href="<%= dashboard_organizer_event_path(event) %>"><i class="icon icon-xs icon-order"></i> Manage Event</a>
                          </li>
                        <% end %>
                        <li>
                          <a href="<%= edit_organizer_event_path(event) %>"><i class="icon icon-xs icon-edit"></i> Edit</a>
                        </li>
                        <% if event.status.published? %>
                          <li><%#= unpublish_organizer_event_path(event) %>
                            <a href="<%= client_event_path(event) %>" target="_blank"><i class="icon icon-xs icon-unpublish"></i> View Event</a>
                          </li>
                        <% else %>
                          <li>
                            <a href="<%= published_organizer_event_path(event) %>"><i class="icon icon-xs icon-publish"></i> Go Live</a>
                          </li>
                          <li>
                            <a><i class="fa fa-trash-o fa-lg" aria-hidden="true"></i> Delete</a>
                          </li>
                        <% end %>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<script type="text/javascript">
  $('.sort').on('change', function(){
    var sort = $(this).val();
    var url = $('.current-url').val();
    window.location = url + '&sort=' + sort
  })
</script>
