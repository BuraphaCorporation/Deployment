
          <div class="form-section">
            <div class="form-header">
              <h1 class="form-title">1. Event Detail
                <% if @event.user.present? %>
                <span style="font-size: 14px;">
                <%= "by <b> #{@event.user.try(:first_name)} #{@event.user.try(:last_name)}</b> and ".html_safe %>status is
                <% if @event.status.published? %>
                  <i class="fa fa-check-circle" aria-hidden="true"></i> <%= @event.status %>
                <% else %>
                  <i class="fa fa-chevron-circle-down" aria-hidden="true"></i> <%= @event.status %>
                <% end %>
                </span>
                <% end %>
              </h1>
            </div>

            <% if current_user.admin? %>
              <div class="form-body row">
                <div class="col-xs-12 col-md-6">
                  <div class="form-group">
                    <label>Organizer </label> &nbsp;
                    <select name="organizer">
                      <option name="">Select organizer</option>
                      <% @organizer.each do |organizer| %>
                        <option value="<%= organizer.id %>"><%= "#{organizer.first_name} #{organizer.last_name}" %></option>
                      <% end %>
                    </select>
                  </div>
                </div>
              </div>
            <% end %>

            <div class="form-body row">
              <div class="col-xs-12 col-md-6">
                <div class="form-group">
                  <label>Event Title</label>
                  <input class="form-control" name="title" value="<%= @event.title %>" data-parsley-required="true" />
                </div>
                <div class="form-group">
                  <label>Event Slug</label>
                  <input class="form-control" name="slug" value="<%= @event.slug %>" />
                </div>

                <div class="form-group">
                  <label>Ticket type</label>
                  <div class="radio">
                    <label><input type="radio" name="ticket_type" value="general" <%= "checked" if @event.ticket_type.general? %>>General</label>
                  </div>
                  <div class="radio">
                    <label><input type="radio" name="ticket_type" value="deal" <%= "checked" if @event.ticket_type.deal? %>>Deal</label>
                  </div>
                </div>
                <div class="form-group">
                  <label>Show Highlight</label>
                  <div class="radio">
                    <label><input type="radio" name="show_highlight" value="true" <%= "checked" if @event.show_highlight %>>Show</label>
                  </div>
                  <div class="radio">
                    <label><input type="radio" name="show_highlight" value="false" <%= "checked" unless @event.show_highlight %>>Hide</label>
                  </div>
                </div>
                <div class="form-group">
                  <label>Category</label>
                  <div class="category-list row">
                    <% @categories.each do |category| %>
                    <div class="col-xs-12 col-md-6">
                      <label class="category">
                        <input type="checkbox" name="category_ids[]" value="<%= category.id %>" <% if @event.categories.where(:id => category.id).exists? %>checked<% end %> />
                        <%= category.title %>
                      </label>
                    </div>
                    <% end %>
                  </div>
                </div>
                <div class="form-group">
                  <label>Shot Description</label>
                  <textarea style="height: 100px" class="form-control" name="short_description" rows="10"><%= @event.short_description %></textarea>
                </div>
                <div class="form-group">
                  <label>Why This?</label>
                  <textarea style="height: 100px" class="form-control" name="whythis" rows="10"><%= @event.whythis %></textarea>
                </div>
                <div class="form-group">
                  <label>Description</label>
                  <textarea style="height: 300px" class="form-control" name="description" rows="10"><%= @event.description %></textarea>
                </div>
                <div class="form-group">
                  <label>Instruction</label>
                  <textarea style="height: 200px"  class="form-control" name="instruction" rows="10"><%= @event.instruction %></textarea>
                </div>
                <div class="form-group">
                  <label>Location</label>
                  <input class="form-control" name="location_name" value="<%= @event.location_name %>" placeholder="eg. Hubba Thailand" data-parsley-required="true" />
                </div>
                <div class="form-group">
                  <label>Address</label>
                  <input class="form-control" name="location_address" value="<%= @event.location_address %>" placeholder="eg. 19 Soi Ekkamai 4, Sukumvit 63 Rd., Prakanong Nua, Bangkok 10110" />
                </div>
                <div class="form-group">
                  <label>Location on Map</label>
                  <div class="form-inline">
                    <input class="form-control" type="text" name="latitude" id="event_latitude" value="<%= @event.latitude %>" placeholder="Latitude" />
                    <input class="form-control" type="text" name="longitude" id="event_longitude" value="<%= @event.longitude %>" placeholder="Longitude" />
                  </div>
                  <input id="pac-input" class="controls" type="text" placeholder="Search Box">
                  <div id="organizer-map" style="margin-top: 15px; height: 300px;"></div>
                </div>
              </div>
              <div class="col-xs-12 col-md-6">
                <div class="form-group">
                  <label>Cover (1600x500px - 1 ภาพ)</label>
                  <input class="form-control" type="file" name="cover" data-parsley-required="true" />
                </div>
                <div class="image-list row">
                  <div class="col-xs-12">
                    <div class="image" style="background-image: url(<%= @event.cover(:full) %>);"></div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Facebook og (1200x630px - 1 ภาพ)</label>
                  <input class="form-control" type="file" name="social_share" data-parsley-required="true" />
                </div>
                <div class="image-list row">
                  <div class="col-xs-12">
                    <div class="image" style="background-image: url(<%= @event.social_share(:facebook) %>);"></div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Images (1200x800px - ไม่จำกัดจำนวน)</label>
                  <input class="form-control" type="file" name="event_pictures[]" multiple data-parsley-required="true" />
                </div>
                <div class="image-list sortable row attachments">
                  <!-- <% @images.each_with_index do |image, index| %>
                    <div class="col-xs-12" data-id="<%= image.id %>" data-index="<%= index %>">
                      <div class="remove" style="position: absolute; top: -15px; right: 0px; z-index: 1000;" onclick="return removeImage('<%= image.id %>')">
                        <i class="glyphicon glyphicon-remove-circle"></i>
                      </div>
                      <div class="image" style="background-image: url(<%= image.media(:thumb) %>);"></div>
                    </div>
                  <% end unless @images.nil? %>
                  -->
                </div>
              </div>
            </div>
          </div>

          <div class="form-section">
            <div class="form-header">
              <h1 class="form-title">2. Ticket Detail</h1>
            </div>

            <% if @sections.blank? and not @sections.nil? %>
              <a class="btn btn-sm btn-default btn-ticket-add" href="javasctipt:;" onclick="return onTicketAdd(this);"><i class="fa fa-plus"></i></a>
            <% end %>

            <div class="form-body">
              <!-- <div class="table-responsive"> -->
                <table class="table table-hover ticket-list">
                  <thead>
                    <tr>
                      <td>Ticket Title</td>
                      <td>Ticket Available</td>
                      <td>Ticket Price (ราคาเต็ม)</td>
                      <td>Ticket Price (ราคาลด)</td>
                      <!-- <td>Ticket Unit</td> -->
                      <td>From</td>
                      <td>To</td>
                      <td><!-- Action --></td>
                    </tr>
                  </thead>
                  <tbody
                    <% @sections.each do |section| %>
                      <tr class="tickets" id="ticket-<%= section.id %>" data-ticket-id="<%= section.id %>">
                        <td><input class="form-control" required="" type="text" name="tickets[<%= section.id %>][title]" value="<%= section.title %>" placeholder="eg. General, VIP" /></td>
                        <td><input class="form-control" required="" type="number" name="tickets[<%= section.id %>][total]" value="<%= section.total %>" /></td>
                        <td><input class="form-control" type="number" name="tickets[<%= section.id %>][initial_price]" value="<%= section.initial_price %>" /></td>
                        <td><input class="form-control" required="" type="number" name="tickets[<%= section.id %>][price]" value="<%= section.price %>" /></td>
                        <!-- <td><input class="form-control" type="number" name="tickets[<%= section.id %>][unit]" value="<%= section.unit %>" /></td> -->

                        <td width="200">
                          <div class="form-group">
                            <div class='input-group date datepicker'>
                              <input class="form-control" type="text" name="tickets[<%= section.id %>][event_time]" value="<%= section.event_time.try(:strftime, '%d/%m/%y %H:%M') %>" />
                              <span class="input-group-addon">
                                <span class="glyphicon glyphicon-calendar"></span>
                              </span>
                            </div>
                          </div>
                        </td>
                        <td width="200">
                          <div class="form-group">
                            <div class='input-group date datepicker'>
                              <input class="form-control" type="text" name="tickets[<%= section.id %>][end_time]" value="<%= section.end_time.try(:strftime, '%d/%m/%y %H:%M') %>" />
                              <span class="input-group-addon">
                                <span class="glyphicon glyphicon-calendar"></span>
                              </span>
                            </div>
                          </div>
                        </td>

                        <td width="100" align="right">
                          <a class="btn btn-sm btn-default btn-ticket-delete" href="javasctipt:;" onclick="return onTicketDelete(this);"><i class="fa fa-minus"></i></a>
                          <a class="btn btn-sm btn-default btn-ticket-add" href="javasctipt:;" onclick="return onTicketAdd(this);"><i class="fa fa-plus"></i></a>
                        </td>
                      </tr>
                    <% end if @sections.present? %>
                  </tbody>
                </table>
              <!-- </div> -->
            </div>
          </div>
          <div class="form-footer">
            <button class="btn btn-daydash btn-daydash-green-1">Submit for review</button>
            <!-- <button class="btn btn-daydash btn-daydash-green-1" value="published">Submit</button>
            or
            <button class="btn btn-default" value="unpublish">Save as Draft</button> -->
          </div>

    <!-- Template -->
    <%= render partial: "organizer/parts/section" %>

<script type="text/javascript">

  function sortImage() {
    $('.sortable').sortable({
      cursor: 'move',
      stop: function(event, ui){
        var attachment = $('.attachments > .ui-sortable-handle');

        attachment.each(function(i, el) {
          var mediaId = $(el).attr('data-id');
          var sortIndex = $(el).index();
          // console.log(mediaId);
          // console.log(sortIndex);
          updateImage(mediaId, sortIndex);
        });
      }
    });
  }

  function orderImage() {
    $.ajax({
      url: '<%= order_attachment_organizer_event_path(@event, format: :json) %>',
      type: 'GET',
      success: function(result) {
        var attachment = $('.attachments');

        attachment.empty()

        // console.log(result);
        $.each(result, function(i){
          var data = result[i]

          var div = $('<div class="col-xs-12"></div>');
          var remove = $('<div class="remove"><i class="glyphicon glyphicon-remove-circle"></i></div>');
          var image = $('<div class="image"></div>');

          div.attr('data-id', data.id);
          div.attr('data-index', data.sort_index);

          remove.css('position', 'absolute')
                .css('top', '-15px')
                .css('right', '0px')
                .css('z-index', '1000')
                .css('cursor', 'pointer');

          remove.attr('onclick', 'return removeImage("'+ data.id +'")')

          image.css('background-image', 'url(' + data.media + ')');

          div.append(remove).append(image);

          attachment.append(div);
        });

        sortImage()
      }
    });
  }

  $(function(){
    orderImage();
  });

  function updateImage(media_id, sort_index) {
    $.ajax({
      url: '<%= update_attachment_organizer_event_path(@event) %>',
      data: {
        'media_id': media_id,
        'sort_index': sort_index
      },
      type: 'PUT',
      success: function(result) {
        // console.log("ok");
      }
    });
  }

  function removeImage(media_id) {
    $.ajax({
      url: '<%= delete_attachment_organizer_event_path(@event) %>',
      data: {
        'media_id': media_id
      },
      type: 'DELETE',
      success: function(result) {
        orderImage();
      }
    });
  }
</script>
