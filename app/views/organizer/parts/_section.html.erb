<script>

  $(function () {
      $('.event-time').datetimepicker({
        format: 'DD/MM/YYYY HH:mm',
        stepping: 30
          // defaultDate: "11/1/2013",
          // disabledDates: [
          //     moment("12/25/2013"),
          //     new Date(2013, 11 - 1, 21),
          //     "11/22/2013 00:53"
          // ]
      });
  });

  function initDatetimepicker(element) {
    $('.datepicker', element).datetimepicker({
      format: 'DD/MM/YYYY'
    });

    $('.timepicker', element).datetimepicker({
      format: 'HH:mm',
      stepping: 30
    })

    $('.start-time', element).on("dp.change", function (e) {
      element.find('.end-time').data("DateTimePicker").minDate(e.date);
    });

    return false;
  }

  function onTicketAdd(button) {
    var template = $('#new-ticket-template').html();
    Mustache.parse(template);
    var rendered = Mustache.render(template, {});
    var element = $(rendered);
    $('.new-ticket').append(element);

    initDatetimepicker(element);

    return false;
  }

  function onTicketDelete(button, section_id = null) {
    var element = $(button).parents('.section-ticket');

    if(section_id != null)
      swal({
        title: 'Are you sure?',
        // text: "You won't be able to revert this!",
        type: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, delete it!'
      }).then(function(){
        $.ajax({
          url: '<%= delete_section_organizer_event_path(@event) %>',
          data: {
            'section_id': section_id
          },
          type: 'DELETE',
          success: function(result) {
            if(result == 'success') {
              swal(
                'Deleted!',
                'Your file has been deleted.',
                'success'
              )
              element.remove();
            }
            else {
              swal(
                'Failure!',
                'ไม่สามารถลบ Ticket นี้ได้เนื่องจากได้ดำเนินการขายอยู่',
                'error'
              )
            }
          }
        });
      })
    else
      element.remove();

    return false;
  }

  $(document).ready(function(){
    initDatetimepicker($('body'));
  });
</script>

<!-- Template -->
<script id="new-ticket-template" type="x-tmpl-mustache">
  <div class="row section-ticket">
    <div class="col-xs-4 form-group">
      <label for="tickets-name">Ticket name</label>
      <input type="text"
             name="new_ticket_names[]"
             id="tickets-name"
             value=""
             placeholder="eg. General, VIP"
             class="form-control"
             required="true" />
    </div>
    <div class="col-xs-2 form-group">
      <label for="tickets-quantity">Quantity available</label>
      <input type="number"
             name="new_ticket_totals[]"
             id="tickets-quantity"
             value=""
             placeholder="eg. 10, 50, 100"
             class="form-control"
             required="true" />
    </div>
    <div class="col-xs-2 form-group">
      <label for="tickets-price">Price</label>
      <input type="number"
             name="new_ticket_prices[]"
             id="tickets-price"
             value=""
             placeholder="eg. 1000, 2000"
             class="form-control"
             required="true" />
    </div>
    <div class="col-xs-2 form-group">
      <label for="tickets-discount">Discount</label>
      <input type="number"
             name="new_ticket_discounts[]"
             id="tickets-discount"
             value=""
             placeholder="eg. 100, 200"
             class="form-control" />
    </div>
    <div class="col-xs-2 form-group">
      <label for="tickets-sales-end">Actions</label>
      <p>
        <a class="btn btn-sm btn-default btn-ticket-delete" href="javasctipt:;" onclick="return onTicketDelete(this);"><i class="fa fa-trash"></i></a>
      </p>
    </div>
    <div class="col-xs-6">
      <label for="tickets-sales-start">Ticket sales start</label>
      <div class="row">
        <div class="col-xs-8 form-group">
          <div class='input-group date'>
            <input type="text"
                  name="new_ticket_start_date[]"
                  class="form-control datepicker"
                  placeholder="DD/MM/YY" />
            <span class="input-group-addon">
              <span class="fa fa-calendar"></span>
            </span>
          </div>
        </div>
        <div class="col-xs-4 form-group">
          <div  class="input-group date">
            <input type="text"
                  name="new_ticket_start_time[]"
                  class="form-control timepicker"
                  placeholder="HH:mm" />
            <span class="input-group-addon">
              <span class="fa fa-clock-o"></span>
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-6">
      <label for="tickets-sales-start">Ticket sales end</label>
      <div class="row">
        <div class="col-xs-8 form-group">
          <div class='input-group date'>
            <input type="text"
                  name="new_ticket_end_date[]"
                  class="form-control datepicker"
                  placeholder="DD/MM/YY" />
            <span class="input-group-addon">
              <span class="fa fa-calendar"></span>
            </span>
          </div>
        </div>
        <div class="col-xs-4 form-group">
          <div  class="input-group date">
            <input type="text"
                  name="new_ticket_end_time[]"
                  class="form-control timepicker"
                  placeholder="HH:mm" />
            <span class="input-group-addon">
              <span class="fa fa-clock-o"></span>
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-12"><hr></div>
  </div>
</script>
