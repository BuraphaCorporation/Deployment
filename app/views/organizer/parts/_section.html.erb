<script>
  function initDatetimepicker(element) {
    $('.datepicker', element).datetimepicker({
      format: 'DD/MM/YYYY'
    });

    $('.timepicker', element).datetimepicker({
      format: 'HH:mm',
      stepping: 30
    })

    $('.start-time', element).on("dp.change", function (e) {
      element.find('.end-time').data("DateTimePicker").minDate(e.date);
    });

    return false;
  }

  function onTicketAdd(button) {
    var template = $('#new-ticket-template').html();
    Mustache.parse(template);
    var rendered = Mustache.render(template, {});
    var element = $(rendered);
    $('.new-ticket').append(element);

    initDatetimepicker(element);

    return false;
  }

  function onTicketDelete(button) {
    var element = $(button).parents('.ticket');
    console.log(element);
    element.remove();

    return false;
  }

  $(document).ready(function(){
    initDatetimepicker($('body'));
  });
</script>


<!-- Template -->
<script id="new-ticket-template" type="x-tmpl-mustache">
  <div class="row">
    <div class="col-xs-4 form-group">
      <label for="tickets-name">Ticket name</label>
      <input type="text"
             name="new_ticket_names[]"
             id="tickets-name"
             value=""
             placeholder="eg. General, VIP"
             class="form-control"
             required="true" />
    </div>
    <div class="col-xs-2 form-group">
      <label for="tickets-quantity">Quantity available</label>
      <input type="number"
             name="new_ticket_totals[]"
             id="tickets-quantity"
             value=""
             placeholder="eg. 10, 50, 100"
             class="form-control"
             required="true" />
    </div>
    <div class="col-xs-2 form-group">
      <label for="tickets-price">Price</label>
      <input type="number"
             name="new_ticket_prices[]"
             id="tickets-price"
             value=""
             placeholder="eg. 1000, 2000"
             class="form-control"
             required="true" />
    </div>
    <div class="col-xs-2 form-group">
      <label for="tickets-discount">Discount</label>
      <input type="number"
             name="new_ticket_discounts[]"
             id="tickets-discount"
             value=""
             placeholder="eg. 100, 200"
             class="form-control" />
    </div>

    <div class="col-xs-2 form-group">
      <label for="tickets-sales-end">Actions</label>
      <p>
        <a class="btn btn-sm btn-default btn-ticket-add" href="javasctipt:;" onclick="return onTicketAdd(this);"><i class="fa fa-cog"></i></a>
        <a class="btn btn-sm btn-default btn-ticket-delete" href="javasctipt:;" onclick="return onTicketDelete(this);"><i class="fa fa-trash"></i></a>
      </p>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-6">
      <label for="tickets-sales-start">Ticket sales start</label>
      <div class="row">
        <div class="col-xs-8 form-group">
          <div class='input-group date'>
            <input type="text"
                  name="new_ticket_start_date[]"
                  class="form-control datepicker"
                  placeholder="DD/MM/YY" />
            <span class="input-group-addon">
              <span class="fa fa-calendar"></span>
            </span>
          </div>
        </div>
        <div class="col-xs-4 form-group">
          <div  class="input-group date">
            <input type="text"
                  name="new_ticket_start_time[]"
                  class="form-control timepicker"
                  placeholder="HH:mm" />
            <span class="input-group-addon">
              <span class="fa fa-clock-o"></span>
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-6">
      <label for="tickets-sales-start">Ticket sales end</label>
      <div class="row">
        <div class="col-xs-8 form-group">
          <div class='input-group date'>
            <input type="text"
                  name="new_ticket_end_date[]"
                  class="form-control datepicker"
                  placeholder="DD/MM/YY" />
            <span class="input-group-addon">
              <span class="fa fa-calendar"></span>
            </span>
          </div>
        </div>
        <div class="col-xs-4 form-group">
          <div  class="input-group date">
            <input type="text"
                  name="new_ticket_end_time[]"
                  class="form-control timepicker"
                  placeholder="HH:mm" />
            <span class="input-group-addon">
              <span class="fa fa-clock-o"></span>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <hr>
</script>
